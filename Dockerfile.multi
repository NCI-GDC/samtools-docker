ARG REPOSITORY=docker.osdc.io
ARG BUILDER_TAG=3.1.0
FROM ${REPOSITORY}/ncigdc/amzn2023-builder:${BUILDER_TAG} AS builder

ARG VERSION

ENV SAMTOOLS_URL=https://github.com/samtools/samtools/releases/download/$VERSION/samtools-$VERSION.tar.bz2

RUN dnf install -y \
	autoconf \
	automake \
	make \
	gcc \
	perl \
	zlib-devel \
	bzip2-devel \
	xz-devel \
	wget \
	libressl-devel \
	ncurses-devel

RUN apk add --no-cache musl-dev

RUN wget $SAMTOOLS_URL \
	&& tar xf samtools-$VERSION.tar.bz2 \
	&& make -C samtools-$VERSION \
	&& make -C samtools-$VERSION install \
	&& rm -rf samtools-$VERSION

# For a multi-stage build

FROM ${REPOSITORY}/ncigdc/amzn2023:${BUILDER_TAG}

COPY --from=builder /usr/local/* /usr/local/
